{% extends "base.html" %}

{% block title %}Dashboard - Smarto Attend{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-8">
        <h2><i class="fas fa-tachometer-alt me-2"></i>Dashboard</h2>
        <p class="text-muted">Welcome back, {{ session.get('user_id') }}</p>
    </div>
    <div class="col-md-4 text-end">
        <span class="badge bg-secondary">{{ today }}</span>
    </div>
</div>

<!-- Stats Cards -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card text-white bg-primary mb-3 h-100">
            <div class="card-header border-0"><i class="fas fa-clock me-1"></i> Current Period</div>
            <div class="card-body">
                {% if stats.current_period %}
                <h5 class="card-title">{{ stats.current_period.period_name }}</h5>
                <p class="card-text small">{{ stats.current_period.start_time[:5] }} - {{
                    stats.current_period.end_time[:5] }}</p>
                {% else %}
                <h5 class="card-title">Free Time</h5>
                <p class="card-text small">No active period</p>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-success mb-3 h-100">
            <div class="card-header border-0"><i class="fas fa-user-check me-1"></i> Present Today</div>
            <div class="card-body">
                <h3 class="display-6">{{ stats.present_today }}</h3>
                <p class="card-text small">Out of {{ stats.total_students }} students</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-info mb-3 h-100">
            <div class="card-header border-0"><i class="fas fa-chart-pie me-1"></i> Attendance Rate</div>
            <div class="card-body">
                <h3 class="display-6">{{ "%.1f"|format(stats.attendance_rate) }}%</h3>
                <p class="card-text small">Overall Daily Rate</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-danger mb-3 h-100">
            <div class="card-header border-0"><i class="fas fa-user-times me-1"></i> Absent Today</div>
            <div class="card-body">
                <h3 class="display-6">{{ stats.absent_today }}</h3>
                <p class="card-text small">Students not seen</p>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="row">
    <div class="col-12">
        <div class="card bg-dark text-light border-secondary">
            <div class="card-header border-secondary">
                <h5 class="mb-0"><i class="fas fa-bolt me-2"></i>Quick Actions</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-3 d-md-block">
                    <a href="{{ url_for('attendance_period') }}" class="btn btn-lg btn-success me-md-2">
                        <i class="fas fa-video me-2"></i> Live Class
                    </a>

                    <a href="{{ url_for('period_reports') }}" class="btn btn-lg btn-info me-md-2">
                        <i class="fas fa-chart-line me-2"></i> View Reports
                    </a>

                    {% if session.get('user_role') in ['admin', 'teacher'] %}
                    <a href="{{ url_for('students') }}" class="btn btn-lg btn-primary me-md-2">
                        <i class="fas fa-users me-2"></i> Students
                    </a>
                    {% endif %}

                    {% if session.get('user_role') == 'admin' %}
                    <a href="{{ url_for('train_model') }}" class="btn btn-lg btn-warning me-md-2">
                        <i class="fas fa-brain me-2"></i> Train Model
                    </a>
                    <a href="{{ url_for('add_student') }}" class="btn btn-lg btn-secondary">
                        <i class="fas fa-user-plus me-2"></i> Add Student
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}