{% extends "base.html" %}

{% block title %}Period Reports{% endblock %}

{% block content %}
<div class="row mb-4 align-items-center">
    <div class="col-md-6">
        <h2><i class="fas fa-chart-bar me-2"></i>Daily Period Reports</h2>
    </div>
    <div class="col-md-6 text-end">
        <form class="d-inline-flex align-items-center" method="GET">
            <input type="date" name="date" class="form-control bg-dark text-light border-secondary me-2"
                value="{{ selected_date }}" onchange="this.form.submit()">
            <a href="{{ url_for('export_period_attendance', date=selected_date) }}" class="btn btn-success">
                <i class="fas fa-file-excel me-1"></i> Export Excel
            </a>
        </form>
    </div>
</div>

<!-- Daily Summary Cards -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card bg-dark text-light border-secondary text-center h-100">
            <div class="card-body">
                <h6 class="text-muted">Total Students</h6>
                <h3 class="display-6 highlight-text">{{ summary.total_students }}</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-dark text-light border-secondary text-center h-100">
            <div class="card-body">
                <h6 class="text-muted">Total Periods</h6>
                <h3 class="display-6">{{ summary.total_periods }}</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-dark text-light border-secondary text-center h-100">
            <div class="card-body">
                <h6 class="text-muted">Total Presences</h6>
                <h3 class="display-6 text-success">{{ summary.total_present_all }}</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-dark text-light border-secondary text-center h-100">
            <div class="card-body">
                <h6 class="text-muted">Overall Attendance</h6>
                <h3 class="display-6 text-info">{{ summary.overall_attendance }}%</h3>
            </div>
        </div>
    </div>
</div>

<!-- Period Breakdown -->
<div class="card bg-dark text-light border-secondary">
    <div class="card-header border-secondary">
        <h5 class="mb-0">Period-wise Breakdown</h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-dark table-hover align-middle">
                <thead>
                    <tr>
                        <th>Period</th>
                        <th>Subject</th>
                        <th>Teacher</th>
                        <th>Attendance</th>
                        <th>Present / Total</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for period_id, p_summary in summary.period_summary.items() %}
                    <tr>
                        <td>
                            <strong>{{ p_summary.period_name }}</strong>
                        </td>
                        <td>{{ p_summary.subject }}</td>
                        <td>{{ p_summary.teacher }}</td>
                        <td>
                            <div class="progress" style="height: 20px;">
                                <div class="progress-bar bg-{{ 'success' if p_summary.attendance_percentage >= 75 else 'warning' if p_summary.attendance_percentage >= 50 else 'danger' }}"
                                    role="progressbar" style="width: {{ p_summary.attendance_percentage }}%">
                                    {{ p_summary.attendance_percentage }}%
                                </div>
                            </div>
                        </td>
                        <td>
                            <span class="text-success">{{ p_summary.present }}</span> / {{ p_summary.total_students }}
                        </td>
                        <td>
                            {% if p_summary.attendance_percentage >= 90 %}
                            <span class="badge bg-success">Excellent</span>
                            {% elif p_summary.attendance_percentage >= 75 %}
                            <span class="badge bg-info">Good</span>
                            {% elif p_summary.attendance_percentage >= 50 %}
                            <span class="badge bg-warning text-dark">Average</span>
                            {% else %}
                            <span class="badge bg-danger">Low</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="6" class="text-center py-4 text-muted">
                            No data available for this date.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12 text-center">
        <p class="text-muted small">
            <i class="fas fa-info-circle me-1"></i>
            Break periods are excluded from attendance statistics.
        </p>
    </div>
</div>
{% endblock %}